---
// Este componente es solo la UI del formulario.
// No necesita 'props' ni '<script>'.
// El script en 'ReportManager.astro' lo controlará usando los 'id'.
---

<form id="reportForm" class="space-y-6">
  <div class="form-control w-full">
    <label class="label" for="terminalAutomotriz">
      <span class="label-text font-medium">Terminal Automotriz (Cliente)</span>
    </label>
    <select
      id="terminalAutomotriz"
      required
      class="select select-bordered w-full"></select>
  </div>

  <div class="form-control w-full">
    <label class="label" for="residente">
      <span class="label-text font-medium">Residente</span>
    </label>
    <select id="residente" required class="select w-full"></select>
  </div>

  <div id="residenteEmailDiv" class="hidden form-control w-full">
    <label class="label" for="residenteEmailInput">
      <span class="label-text font-medium">Email del Residente</span>
    </label>
    <input
      type="email"
      id="residenteEmailInput"
      placeholder="residente@ejemplo.com"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label" for="turno">
      <span class="label-text font-medium">Turno</span>
    </label>
    <select id="turno" required class="select w-full"></select>
  </div>

  <div class="form-control w-full">
    <label class="label" for="producto">
      <span class="label-text font-medium">Producto</span>
    </label>
    <select id="producto" required class="select w-full"></select>
  </div>

  <div id="productoOtroDiv" class="hidden form-control w-full">
    <label class="label" for="productoOtroInput">
      <span class="label-text font-medium">Especificar Producto</span>
    </label>
    <input
      type="text"
      id="productoOtroInput"
      placeholder="Ej: Espejo retrovisor"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label" for="pieza">
      <span class="label-text font-medium">Pieza en Específico</span>
    </label>
    <input
      type="text"
      id="pieza"
      required
      placeholder="Ej: Espejo lateral derecho"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label" for="cantidadNoConforme">
      <span class="label-text font-medium">Cantidad No Conforme</span>
    </label>
    <input
      type="number"
      id="cantidadNoConforme"
      required
      min="1"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label" for="motivoNoConforme">
      <span class="label-text font-medium">Motivo No Conforme</span>
    </label>
    <select id="motivoNoConforme" required class="select w-full"></select>
  </div>

  <div id="motivoNoConformeOtroDiv" class="hidden form-control w-full">
    <label class="label" for="motivoNoConformeOtroInput">
      <span class="label-text font-medium">Especificar Motivo</span>
    </label>
    <input
      type="text"
      id="motivoNoConformeOtroInput"
      placeholder="Ej: Ruptura por mala manipulación"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label" for="zona">
      <span class="label-text font-medium">Zona (Ubicación del problema)</span>
    </label>
    <select id="zona" required class="select w-full"></select>
  </div>

  <div id="zonaOtroDiv" class="hidden form-control w-full">
    <label class="label" for="zonaOtroInput">
      <span class="label-text font-medium">Especificar Zona</span>
    </label>
    <input
      type="text"
      id="zonaOtroInput"
      placeholder="Ej: Interior del baúl"
      class="input w-full"
    />
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
    <div class="form-control w-full">
      <label class="label" for="rotacionSecuencia">
        <span class="label-text font-medium">Rotación / Secuencia</span>
      </label>
      <input
        type="text"
        id="rotacionSecuencia"
        placeholder="Ej: 12345"
        class="input w-full"
      />
    </div>
    <div class="form-control w-full">
      <label class="label" for="vinHu">
        <span class="label-text font-medium">VIN / HU</span>
      </label>
      <input
        type="text"
        id="vinHu"
        placeholder="Ej: ABC123DEF456"
        class="input w-full"
      />
    </div>
  </div>

  <div class="form-control w-full">
    <label class="label" for="defectoProceso">
      <span class="label-text font-medium">Defecto de Proceso</span>
    </label>
    <select id="defectoProceso" required class="select w-full"></select>
  </div>

  <div id="defectoProcesoOtroDiv" class="hidden form-control w-full">
    <label class="label" for="defectoProcesoOtroInput">
      <span class="label-text font-medium">Especificar Defecto de Proceso</span>
    </label>
    <input
      type="text"
      id="defectoProcesoOtroInput"
      placeholder="Ej: Ensamblado incorrecto de pieza"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label">
      <span class="label-text font-medium"
        >Trazabilidad de Etiqueta (Subir una o más fotos)</span
      >
    </label>
    <div
      class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-base-300 border-dashed rounded-md"
    >
      <div class="space-y-1 text-center">
        <svg
          class="mx-auto h-12 w-12 text-gray-400"
          stroke="currentColor"
          fill="none"
          viewBox="0 0 48 48"
          aria-hidden="true"
        >
          <path
            d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-8m32-4l-3.293-3.293a1 1 0 00-1.414 0L28 28m0 0l4 4m-4-4l-1.414-1.414a1 1 0 00-1.414 0L14 36m24 0H8"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
        <div
          class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-2"
        >
          <label
            for="etiquetaInput"
            class="btn btn-ghost text-primary relative cursor-pointer"
          >
            <span>Subir archivos</span>
            <input
              id="etiquetaInput"
              name="etiqueta"
              type="file"
              class="sr-only"
              accept="image/*"
              multiple
            />
          </label>
          <label
            for="etiquetaInputCamera"
            class="btn btn-ghost text-primary relative cursor-pointer"
          >
            <span>Tomar foto</span>
            <input
              id="etiquetaInputCamera"
              name="etiqueta"
              type="file"
              class="sr-only"
              accept="image/*"
              capture="environment"
              multiple
            />
          </label>
        </div>
        <p class="text-xs text-gray-500">PNG, JPG, GIF</p>
      </div>
    </div>
    <div id="etiquetaPreview" class="mt-4 hidden">
      <p class="text-sm font-medium text-gray-700 mb-2">
        Previsualización de las etiquetas:
      </p>
      <div id="previewEtiquetaContainer" class="image-preview-grid"></div>
    </div>
  </div>

  <div class="form-control w-full">
    <label class="label" for="accion">
      <span class="label-text font-medium">Acción (Retrabajo)</span>
    </label>
    <select id="accion" required class="select w-full">
      <option value="No">No</option>
      <option value="Si">Sí</option>
    </select>
  </div>

  <div id="accionDetalleDiv" class="hidden form-control w-full">
    <label class="label" for="accionDetalle">
      <span class="label-text font-medium">Detalle del Retrabajo</span>
    </label>
    <textarea
      id="accionDetalle"
      rows="2"
      class="textarea w-full"></textarea>
  </div>

  <div class="divider text-xl font-bold my-8">
    Contención del Problema - Punto de Corte
  </div>

  <div class="form-control w-full">
    <label class="label" for="puntoDeCorte">
      <span class="label-text font-medium"
        >Marcar Punto de Corte (Número de Secuencia)</span
      >
    </label>
    <input
      type="text"
      id="puntoDeCorte"
      placeholder="Ej: 54321"
      class="input w-full"
    />
  </div>

  <div class="form-control w-full">
    <label class="label">
      <span class="label-text font-medium"
        >Identificación del Punto de Corte (Subir una o más fotos)</span
      >
    </label>
    <div
      class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-base-300 border-dashed rounded-md"
    >
      <div class="space-y-1 text-center">
        <svg
          class="mx-auto h-12 w-12 text-gray-400"
          stroke="currentColor"
          fill="none"
          viewBox="0 0 48 48"
          aria-hidden="true"
        >
          <path
            d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-8m32-4l-3.293-3.293a1 1 0 00-1.414 0L28 28m0 0l4 4m-4-4l-1.414-1.414a1 1 0 00-1.414 0L14 36m24 0H8"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
        <div
          class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-2"
        >
          <label
            for="puntoDeCorteInput"
            class="btn btn-ghost text-primary relative cursor-pointer"
          >
            <span>Subir archivos</span>
            <input
              id="puntoDeCorteInput"
              name="puntoDeCorteImage"
              type="file"
              class="sr-only"
              accept="image/*"
              multiple
            />
          </label>
          <label
            for="puntoDeCorteInputCamera"
            class="btn btn-ghost text-primary relative cursor-pointer"
          >
            <span>Tomar foto</span>
            <input
              id="puntoDeCorteInputCamera"
              name="puntoDeCorteImage"
              type="file"
              class="sr-only"
              accept="image/*"
              capture="environment"
              multiple
            />
          </label>
        </div>
        <p class="text-xs text-gray-500">PNG, JPG, GIF</p>
      </div>
    </div>
    <div id="puntoDeCortePreview" class="mt-4 hidden">
      <p class="text-sm font-medium text-gray-700 mb-2">
        Previsualización de las fotos:
      </p>
      <div id="previewPuntoDeCorteContainer" class="image-preview-grid"></div>
    </div>
  </div>

  <div class="pt-4">
    <button type="submit" id="submitButton" class="btn btn-primary w-full">
      Registrar Problema
    </button>
    <div id="loadingIndicator" class="mt-4 hidden text-center text-gray-500">
      <p class="flex items-center justify-center">
        <span class="loading loading-spinner mr-3"></span>
        Guardando reporte...
      </p>
    </div>
  </div>
</form>
